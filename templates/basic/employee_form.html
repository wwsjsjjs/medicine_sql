{% extends "base.html" %}

{% block title %}{% if employee %}ç¼–è¾‘{% else %}æ·»åŠ {% endif %}å‘˜å·¥ - åŒ»è¯ç®¡ç†ç³»ç»Ÿ{% endblock %}
{% block page_title %}{% if employee %}ç¼–è¾‘{% else %}æ·»åŠ {% endif %}å‘˜å·¥{% endblock %}

{% block content %}
<div class="page-header">
    <h2>{% if employee %}ç¼–è¾‘{% else %}æ·»åŠ {% endif %}å‘˜å·¥</h2>
    {% if not employee %}
    <button type="button" onclick="quickFill('employee')" class="btn btn-success">
        ğŸ² å¿«é€Ÿå¡«å……æµ‹è¯•æ•°æ®
    </button>
    {% endif %}
</div>

<div class="table-card">
    <form method="post" onsubmit="return validateEmployeeForm()">
        <div class="form-row">
            <div class="form-group">
                <label for="name">å§“å *</label>
                <input type="text" id="name" name="name" class="form-control" 
                       value="{{ employee.name if employee else '' }}" 
                       placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰" required>
            </div>
            
            <div class="form-group">
                <label for="department">éƒ¨é—¨</label>
                <select id="department" name="department" class="form-control">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="é”€å”®éƒ¨" {% if employee and employee.department == 'é”€å”®éƒ¨' %}selected{% endif %}>é”€å”®éƒ¨</option>
                    <option value="é‡‡è´­éƒ¨" {% if employee and employee.department == 'é‡‡è´­éƒ¨' %}selected{% endif %}>é‡‡è´­éƒ¨</option>
                    <option value="ä»“å‚¨éƒ¨" {% if employee and employee.department == 'ä»“å‚¨éƒ¨' %}selected{% endif %}>ä»“å‚¨éƒ¨</option>
                    <option value="è´¢åŠ¡éƒ¨" {% if employee and employee.department == 'è´¢åŠ¡éƒ¨' %}selected{% endif %}>è´¢åŠ¡éƒ¨</option>
                    <option value="è¡Œæ”¿éƒ¨" {% if employee and employee.department == 'è¡Œæ”¿éƒ¨' %}selected{% endif %}>è¡Œæ”¿éƒ¨</option>
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="position">èŒä½</label>
                <input type="text" id="position" name="position" class="form-control" 
                       value="{{ employee.position if employee else '' }}"
                       placeholder="ä¾‹å¦‚ï¼šé”€å”®ç»ç†">
            </div>
            
            <div class="form-group">
                <label for="phone">ç”µè¯</label>
                <input type="tel" id="phone" name="phone" class="form-control" 
                       value="{{ employee.phone if employee else '' }}"
                       placeholder="ä¾‹å¦‚ï¼š13800138000">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="hire_date">å…¥èŒæ—¥æœŸ</label>
                <input type="date" id="hire_date" name="hire_date" class="form-control" 
                       value="{{ employee.hire_date if employee else '' }}">
            </div>
            
            <div class="form-group">
                <label for="status">çŠ¶æ€</label>
                <select id="status" name="status" class="form-control">
                    <option value="åœ¨èŒ" {% if employee and employee.status == 'åœ¨èŒ' %}selected{% endif %}>åœ¨èŒ</option>
                    <option value="ç¦»èŒ" {% if employee and employee.status == 'ç¦»èŒ' %}selected{% endif %}>ç¦»èŒ</option>
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="account">è´¦å·</label>
                <input type="text" id="account" name="account" class="form-control" 
                       value="{{ employee.account if employee else '' }}"
                       placeholder="ä¾‹å¦‚ï¼šzhangsan">
            </div>
            
            <div class="form-group">
                <label for="password">å¯†ç  {% if employee %}(ç•™ç©ºåˆ™ä¸ä¿®æ”¹){% endif %}</label>
                <input type="password" id="password" name="password" class="form-control">
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">ä¿å­˜</button>
            <a href="{{ url_for('basic.employee_list') }}" class="btn btn-secondary">å–æ¶ˆ</a>
        </div>
    </form>
</div>

<script>
function validateEmployeeForm() {
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const account = document.getElementById('account').value.trim();
    
    if (!name) {
        alert('è¯·è¾“å…¥å‘˜å·¥å§“å');
        return false;
    }
    
    // ç”µè¯å·ç éªŒè¯
    if (phone && !/^1[3-9]\d{9}$/.test(phone)) {
        if (!confirm('æ‰‹æœºå·æ ¼å¼å¯èƒ½ä¸æ­£ç¡®ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ')) {
            return false;
        }
    }
    
    // è´¦å·æ ¼å¼éªŒè¯
    if (account && !/^[a-zA-Z][a-zA-Z0-9_]{2,19}$/.test(account)) {
        alert('è´¦å·å¿…é¡»ä»¥å­—æ¯å¼€å¤´ï¼Œé•¿åº¦3-20ä½ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿');
        return false;
    }
    
    return true;
}
</script>

<style>
.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}
