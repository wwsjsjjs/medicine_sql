{% extends "base.html" %}

{% block title %}æ•°æ®ä»ªè¡¨ç›˜ - åŒ»è¯ç®¡ç†ç³»ç»Ÿ{% endblock %}
{% block page_title %}æ•°æ®ä»ªè¡¨ç›˜{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="table-card" style="margin-bottom:16px; display:flex; justify-content:space-between; align-items:center;">
        <div>
            <h3 style="margin:0;">æ•°æ®ç»´æŠ¤</h3>
            <p style="margin:4px 0 0; color:#666;">æ¸…ç©ºæ•°æ®åº“å¹¶æ¢å¤åˆ°åˆå§‹åŸºç¡€æ•°æ®ï¼ˆç®¡ç†å‘˜ã€æƒé™ç­‰ï¼‰ã€‚</p>
        </div>
        <form method="post" action="{{ url_for('dashboard.reset_db') }}" onsubmit="return confirm('ç¡®è®¤æ¸…ç©ºå¹¶é‡æ–°åˆå§‹åŒ–æ•°æ®åº“ï¼Ÿæ‰€æœ‰ä¸šåŠ¡æ•°æ®å°†è¢«åˆ é™¤ï¼');">
            <button type="submit" class="btn btn-danger">ğŸ—‘ï¸ æ¸…ç©ºå¹¶é‡ç½®æ•°æ®åº“</button>
        </form>
    </div>

    <!-- å…³é”®æŒ‡æ ‡å¡ç‰‡ -->
    <div class="stats-grid">
        <div class="stat-card blue">
            <div class="stat-icon">ğŸ’°</div>
            <div class="stat-content">
                <div class="stat-label">ä»Šæ—¥é”€å”®é¢</div>
                <div class="stat-value">Â¥{{ "%.2f"|format(today_sales) }}</div>
            </div>
        </div>
        
        <div class="stat-card green">
            <div class="stat-icon">ğŸ“Š</div>
            <div class="stat-content">
                <div class="stat-label">æœ¬æœˆé”€å”®é¢</div>
                <div class="stat-value">Â¥{{ "%.2f"|format(month_sales) }}</div>
            </div>
        </div>
        
        <div class="stat-card purple">
            <div class="stat-icon">ğŸ“¦</div>
            <div class="stat-content">
                <div class="stat-label">åº“å­˜æ€»æ•°</div>
                <div class="stat-value">{{ total_inventory }}</div>
            </div>
        </div>
        
        <div class="stat-card orange">
            <div class="stat-icon">âš ï¸</div>
            <div class="stat-content">
                <div class="stat-label">ä½åº“å­˜é¢„è­¦</div>
                <div class="stat-value">{{ low_stock_count }}</div>
            </div>
        </div>
        
        <div class="stat-card cyan">
            <div class="stat-icon">ğŸ’Š</div>
            <div class="stat-content">
                <div class="stat-label">è¯å“æ€»æ•°</div>
                <div class="stat-value">{{ total_drugs }}</div>
            </div>
        </div>
    </div>
    
    <!-- ä½åº“å­˜é¢„è­¦è¡¨ -->
    <div class="table-card">
        <h3>åº“å­˜é¢„è­¦ (åº“å­˜ < 100)</h3>
        <table class="data-table">
            <thead>
                <tr>
                    <th>è¯å“åç§°</th>
                    <th>å½“å‰åº“å­˜</th>
                    <th>å•ä½</th>
                    <th>çŠ¶æ€</th>
                </tr>
            </thead>
            <tbody>
                {% for inventory, drug_name, unit in low_stock_items %}
                <tr>
                    <td>{{ drug_name }}</td>
                    <td class="{% if inventory.quantity < 50 %}text-danger{% else %}text-warning{% endif %}">
                        {{ inventory.quantity }}
                    </td>
                    <td>{{ unit }}</td>
                    <td>
                        {% if inventory.quantity < 50 %}
                            <span class="badge badge-danger">ä¸¥é‡ä¸è¶³</span>
                        {% else %}
                            <span class="badge badge-warning">åº“å­˜è¾ƒä½</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
