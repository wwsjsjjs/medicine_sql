{% extends "base.html" %}

{% block title %}è‡ªå®šä¹‰æµ‹è¯•æ•°æ® - åŒ»è¯ç®¡ç†ç³»ç»Ÿ{% endblock %}
{% block page_title %}è‡ªå®šä¹‰æµ‹è¯•æ•°æ®ç”Ÿæˆ{% endblock %}

{% block content %}
<div class="custom-test-page">
    <div class="page-header">
        <h2>ğŸ¨ è‡ªå®šä¹‰æµ‹è¯•æ•°æ®ç”Ÿæˆ</h2>
        <p>å¯ä»¥è‡ªå®šä¹‰æ‰€æœ‰å‚æ•°æ¥ç”Ÿæˆæµ‹è¯•æ•°æ®</p>
    </div>

    <!-- è¯å“è‡ªå®šä¹‰ç”Ÿæˆ -->
    <div class="test-section">
        <h3>ğŸ’Š è‡ªå®šä¹‰è¯å“æ•°æ®</h3>
        <form id="custom-drug-form" class="custom-form">
            <div class="form-grid">
                <div class="form-group">
                    <label>è¯å“åç§° *</label>
                    <input type="text" name="name" class="form-control" required placeholder="ä¾‹å¦‚ï¼šé˜¿è«è¥¿æ—èƒ¶å›Š">
                </div>
                <div class="form-group">
                    <label>è§„æ ¼</label>
                    <input type="text" name="spec" class="form-control" placeholder="ä¾‹å¦‚ï¼š0.25g*24ç²’">
                </div>
                <div class="form-group">
                    <label>ç”Ÿäº§å‚å®¶</label>
                    <input type="text" name="manufacturer" class="form-control" placeholder="ä¾‹å¦‚ï¼šæŸæŸåˆ¶è¯">
                </div>
                <div class="form-group">
                    <label>æ‰¹å‡†æ–‡å·</label>
                    <input type="text" name="approval_number" class="form-control" placeholder="ä¾‹å¦‚ï¼šå›½è¯å‡†å­—H12345678">
                </div>
                <div class="form-group">
                    <label>ç±»åˆ«</label>
                    <select name="category" class="form-control">
                        <option value="å¤„æ–¹">å¤„æ–¹</option>
                        <option value="éå¤„æ–¹">éå¤„æ–¹</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å•ä½</label>
                    <input type="text" name="unit" class="form-control" value="ç›’">
                </div>
                <div class="form-group">
                    <label>è¿›è´§ä»· *</label>
                    <input type="number" step="0.01" name="purchase_price" class="form-control" required placeholder="20.00">
                </div>
                <div class="form-group">
                    <label>é”€å”®ä»· *</label>
                    <input type="number" step="0.01" name="sale_price" class="form-control" required placeholder="35.00">
                </div>
                <div class="form-group">
                    <label>æœ‰æ•ˆæœŸ</label>
                    <input type="date" name="expiry_date" class="form-control">
                </div>
                <div class="form-group">
                    <label>çŠ¶æ€</label>
                    <select name="status" class="form-control">
                        <option value="åœ¨å”®">åœ¨å”®</option>
                        <option value="åœå”®">åœå”®</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">ç”Ÿæˆè¯å“</button>
        </form>
    </div>

    <!-- å®¢æˆ·è‡ªå®šä¹‰ç”Ÿæˆ -->
    <div class="test-section">
        <h3>ğŸª è‡ªå®šä¹‰å®¢æˆ·æ•°æ®</h3>
        <form id="custom-customer-form" class="custom-form">
            <div class="form-grid">
                <div class="form-group">
                    <label>å®¢æˆ·åç§° *</label>
                    <input type="text" name="name" class="form-control" required placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰">
                </div>
                <div class="form-group">
                    <label>ç±»å‹ *</label>
                    <select name="type" class="form-control" required>
                        <option value="é›¶å”®">é›¶å”®</option>
                        <option value="æ‰¹å‘">æ‰¹å‘</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>è”ç³»äºº</label>
                    <input type="text" name="contact" class="form-control" placeholder="ä¾‹å¦‚ï¼šå¼ å…ˆç”Ÿ">
                </div>
                <div class="form-group">
                    <label>ç”µè¯</label>
                    <input type="text" name="phone" class="form-control" placeholder="ä¾‹å¦‚ï¼š13800138000">
                </div>
                <div class="form-group">
                    <label>åœ°å€</label>
                    <input type="text" name="address" class="form-control" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬å¸‚æœé˜³åŒº">
                </div>
            </div>
            <button type="submit" class="btn btn-primary">ç”Ÿæˆå®¢æˆ·</button>
        </form>
    </div>

    <!-- ä¾›åº”å•†è‡ªå®šä¹‰ç”Ÿæˆ -->
    <div class="test-section">
        <h3>ğŸ­ è‡ªå®šä¹‰ä¾›åº”å•†æ•°æ®</h3>
        <form id="custom-supplier-form" class="custom-form">
            <div class="form-grid">
                <div class="form-group">
                    <label>ä¾›åº”å•†åç§° *</label>
                    <input type="text" name="name" class="form-control" required placeholder="ä¾‹å¦‚ï¼šæŸæŸåŒ»è¯æ‰¹å‘">
                </div>
                <div class="form-group">
                    <label>è”ç³»äºº</label>
                    <input type="text" name="contact" class="form-control" placeholder="ä¾‹å¦‚ï¼šæç»ç†">
                </div>
                <div class="form-group">
                    <label>ç”µè¯</label>
                    <input type="text" name="phone" class="form-control" placeholder="ä¾‹å¦‚ï¼š010-12345678">
                </div>
                <div class="form-group">
                    <label>åœ°å€</label>
                    <input type="text" name="address" class="form-control" placeholder="ä¾‹å¦‚ï¼šä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒº">
                </div>
                <div class="form-group">
                    <label>èµ„è´¨ç¼–å·</label>
                    <input type="text" name="qualification_no" class="form-control" placeholder="ä¾‹å¦‚ï¼šQUAL123456">
                </div>
            </div>
            <button type="submit" class="btn btn-primary">ç”Ÿæˆä¾›åº”å•†</button>
        </form>
    </div>

    <!-- å‘˜å·¥è‡ªå®šä¹‰ç”Ÿæˆ -->
    <div class="test-section">
        <h3>ğŸ‘¥ è‡ªå®šä¹‰å‘˜å·¥æ•°æ®</h3>
        <form id="custom-employee-form" class="custom-form">
            <div class="form-grid">
                <div class="form-group">
                    <label>å‘˜å·¥å§“å *</label>
                    <input type="text" name="name" class="form-control" required placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜">
                </div>
                <div class="form-group">
                    <label>éƒ¨é—¨</label>
                    <input type="text" name="department" class="form-control" placeholder="ä¾‹å¦‚ï¼šé”€å”®éƒ¨">
                </div>
                <div class="form-group">
                    <label>èŒä½</label>
                    <input type="text" name="position" class="form-control" placeholder="ä¾‹å¦‚ï¼šé”€å”®ç»ç†">
                </div>
                <div class="form-group">
                    <label>ç”µè¯</label>
                    <input type="text" name="phone" class="form-control" placeholder="ä¾‹å¦‚ï¼š13900139000">
                </div>
                <div class="form-group">
                    <label>å…¥èŒæ—¥æœŸ</label>
                    <input type="date" name="hire_date" class="form-control">
                </div>
                <div class="form-group">
                    <label>è´¦å· *</label>
                    <input type="text" name="account" class="form-control" required placeholder="ä¾‹å¦‚ï¼šwangxm">
                </div>
                <div class="form-group">
                    <label>å¯†ç  *</label>
                    <input type="password" name="password" class="form-control" required placeholder="è‡³å°‘6ä½">
                </div>
                <div class="form-group">
                    <label>çŠ¶æ€</label>
                    <select name="status" class="form-control">
                        <option value="åœ¨èŒ">åœ¨èŒ</option>
                        <option value="ç¦»èŒ">ç¦»èŒ</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">ç”Ÿæˆå‘˜å·¥</button>
        </form>
    </div>

    <!-- æµ‹è¯•æ—¥å¿— -->
    <div class="test-section">
        <h3>ğŸ“ æ“ä½œæ—¥å¿—</h3>
        <div id="customTestLog" class="test-log"></div>
        <button onclick="clearCustomLog()" class="btn btn-secondary">æ¸…ç©ºæ—¥å¿—</button>
    </div>
</div>

<style>
.custom-test-page {
    padding: 20px;
}

.test-section {
    background: white;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}

.test-section h3 {
    margin-top: 0;
    margin-bottom: 20px;
    color: #2d3748;
    border-bottom: 2px solid #f97316;
    padding-bottom: 10px;
}

.custom-form {
    margin-bottom: 20px;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    color: #4a5568;
}

.form-control {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #cbd5e0;
    border-radius: 4px;
    font-size: 14px;
}

.form-control:focus {
    outline: none;
    border-color: #f97316;
}

.test-log {
    background: #f7fafc;
    border: 1px solid #e2e8f0;
    border-radius: 4px;
    padding: 15px;
    max-height: 400px;
    overflow-y: auto;
    font-family: monospace;
    font-size: 13px;
    line-height: 1.6;
}

.log-entry {
    margin: 5px 0;
    padding: 5px 10px;
    border-radius: 3px;
}

.log-success {
    color: #38a169;
    background: #f0fff4;
}

.log-error {
    color: #e53e3e;
    background: #fff5f5;
}

.log-info {
    color: #3182ce;
    background: #ebf8ff;
}
</style>

<script>
function addCustomLog(message, type = 'info') {
    const log = document.getElementById('customTestLog');
    const entry = document.createElement('div');
    entry.className = `log-entry log-${type}`;
    const time = new Date().toLocaleTimeString();
    entry.textContent = `[${time}] ${message}`;
    log.appendChild(entry);
    log.scrollTop = log.scrollHeight;
}

function clearCustomLog() {
    document.getElementById('customTestLog').innerHTML = '';
}

// è¯å“è¡¨å•æäº¤
document.getElementById('custom-drug-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const data = Object.fromEntries(formData);
    
    addCustomLog('æ­£åœ¨ç”Ÿæˆè‡ªå®šä¹‰è¯å“...', 'info');
    
    fetch('/api/test/custom_drug', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            addCustomLog(`âœ“ ${result.message}`, 'success');
            this.reset();
            // è®¾ç½®é»˜è®¤å€¼
            this.querySelector('[name="expiry_date"]').valueAsDate = new Date(Date.now() + 365*24*60*60*1000);
        } else {
            addCustomLog(`âœ— ${result.message}`, 'error');
        }
    })
    .catch(error => {
        addCustomLog(`âœ— ç”Ÿæˆå¤±è´¥: ${error}`, 'error');
    });
});

// å®¢æˆ·è¡¨å•æäº¤
document.getElementById('custom-customer-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const data = Object.fromEntries(formData);
    
    addCustomLog('æ­£åœ¨ç”Ÿæˆè‡ªå®šä¹‰å®¢æˆ·...', 'info');
    
    fetch('/api/test/custom_customer', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            addCustomLog(`âœ“ ${result.message}`, 'success');
            this.reset();
        } else {
            addCustomLog(`âœ— ${result.message}`, 'error');
        }
    })
    .catch(error => {
        addCustomLog(`âœ— ç”Ÿæˆå¤±è´¥: ${error}`, 'error');
    });
});

// ä¾›åº”å•†è¡¨å•æäº¤
document.getElementById('custom-supplier-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const data = Object.fromEntries(formData);
    
    addCustomLog('æ­£åœ¨ç”Ÿæˆè‡ªå®šä¹‰ä¾›åº”å•†...', 'info');
    
    fetch('/api/test/custom_supplier', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            addCustomLog(`âœ“ ${result.message}`, 'success');
            this.reset();
        } else {
            addCustomLog(`âœ— ${result.message}`, 'error');
        }
    })
    .catch(error => {
        addCustomLog(`âœ— ç”Ÿæˆå¤±è´¥: ${error}`, 'error');
    });
});

// å‘˜å·¥è¡¨å•æäº¤
document.getElementById('custom-employee-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const data = Object.fromEntries(formData);
    
    addCustomLog('æ­£åœ¨ç”Ÿæˆè‡ªå®šä¹‰å‘˜å·¥...', 'info');
    
    fetch('/api/test/custom_employee', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            addCustomLog(`âœ“ ${result.message}`, 'success');
            this.reset();
        } else {
            addCustomLog(`âœ— ${result.message}`, 'error');
        }
    })
    .catch(error => {
        addCustomLog(`âœ— ç”Ÿæˆå¤±è´¥: ${error}`, 'error');
    });
});

// è®¾ç½®é»˜è®¤æ—¥æœŸ
document.addEventListener('DOMContentLoaded', function() {
    // è¯å“æœ‰æ•ˆæœŸé»˜è®¤1å¹´å
    const expiryDate = document.querySelector('#custom-drug-form [name="expiry_date"]');
    if (expiryDate) {
        const oneYearLater = new Date();
        oneYearLater.setFullYear(oneYearLater.getFullYear() + 1);
        expiryDate.valueAsDate = oneYearLater;
    }
    
    // å‘˜å·¥å…¥èŒæ—¥æœŸé»˜è®¤ä»Šå¤©
    const hireDate = document.querySelector('#custom-employee-form [name="hire_date"]');
    if (hireDate) {
        hireDate.valueAsDate = new Date();
    }
});
</script>
{% endblock %}
