{% extends "base.html" %}

{% block title %}销售报表 - 医药管理系统{% endblock %}
{% block page_title %}销售报表 - 近一周销售情况{% endblock %}

{% block content %}
<div class="page-header">
    <h2>销售报表（{{ start_date }} 至 {{ end_date }}）</h2>
    <a href="{{ url_for('sales.sales_list') }}" class="btn btn-primary">
        返回销售列表
    </a>
</div>

<!-- 每日销售统计 -->
<div class="chart-card">
    <h3>每日销售统计</h3>
    <canvas id="dailySalesChart"></canvas>
</div>

<!-- 药品销售排行 -->
<div class="table-card" style="margin-top: 30px;">
    <h3>药品销售排行</h3>
    <table class="data-table">
        <thead>
            <tr>
                <th>排名</th>
                <th>药品名称</th>
                <th>销售数量</th>
                <th>销售金额</th>
            </tr>
        </thead>
        <tbody>
            {% for drug in drug_sales %}
            <tr>
                <td>
                    {% if loop.index <= 3 %}
                        <span class="rank-badge rank-{{ loop.index }}">{{ loop.index }}</span>
                    {% else %}
                        {{ loop.index }}
                    {% endif %}
                </td>
                <td><strong>{{ drug[0] }}</strong></td>
                <td>{{ drug[1] }}</td>
                <td>¥{{ "%.2f"|format(drug[2]) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<style>
.rank-badge {
    display: inline-block;
    width: 30px;
    height: 30px;
    line-height: 30px;
    text-align: center;
    border-radius: 50%;
    color: white;
    font-weight: bold;
}
.rank-1 { background: linear-gradient(135deg, #FFD700, #FFA500); }
.rank-2 { background: linear-gradient(135deg, #C0C0C0, #808080); }
.rank-3 { background: linear-gradient(135deg, #CD7F32, #8B4513); }
</style>
{% endblock %}

{% block extra_js %}
<script>
new Chart(document.getElementById('dailySalesChart'), {
    type: 'bar',
    data: {
        labels: [{% for sale in daily_sales %}'{{ sale[0] }}',{% endfor %}],
        datasets: [{
            label: '销售额',
            data: [{% for sale in daily_sales %}{{ sale[1] }},{% endfor %}],
            backgroundColor: 'rgba(102, 126, 234, 0.8)',
            borderColor: 'rgba(102, 126, 234, 1)',
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: true,
                position: 'top'
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function(value) {
                        return '¥' + value;
                    }
                }
            }
        }
    }
});
</script>
{% endblock %}
