# 数据库设计

## 数据库整体说明

本系统数据库设计用于支持医药管理系统，涵盖药品、员工、客户、供应商、权限、库存、销售、财务等核心业务。各表之间通过主外键建立联系，保证数据一致性和业务流转。

### 主要表功能与联系说明

- **drug_info（药品信息表）**：存储所有药品的基础信息，是库存、进货、销售等表的核心关联对象。
- **employee_info（员工信息表）**：记录员工信息，涉及系统操作、入库、销售、盘点等业务的责任人。
- **customer_info（客户信息表）**：保存客户资料，销售业务的关联对象。
- **supplier_info（供应商信息表）**：供应商信息，进货和退货业务的关联对象。
- **permission（权限表）、role（角色表）、role_permission（角色权限关联表）、user_role（用户角色关联表）**：实现系统的权限与角色管理，员工与角色、角色与权限多对多关联。
- **system_log（系统日志表）**：记录系统操作日志，追踪员工对系统的操作。
- **stock_in（入库登记表）**：记录药品入库信息，关联药品、供应商、员工。
- **inventory（库存表）**：反映每种药品在各仓库的库存情况，关联药品和仓库。
- **warehouse（仓库表）**：仓库信息，库存、盘点等表的关联对象。
- **inventory_check（库存盘点表）**：记录库存盘点结果，关联药品、仓库、员工。
- **return_stock（退货处理表）**：药品退货给供应商的记录，关联药品、供应商、员工。
- **sales（销售登记表）**：药品销售记录，关联药品、客户、员工。
- **sales_return（销售退货表）**：客户退货记录，关联销售单、员工。
- **finance_stat（财务统计表）**：财务汇总信息，统计销售、成本、利润等。

### 表之间的主要联系

- **drug_info** 是大多数业务表（如 stock_in、inventory、sales、return_stock、inventory_check）的外键对象。
- **employee_info** 作为操作人，出现在 stock_in、sales、inventory_check、return_stock、system_log 等表中。
- **customer_info** 主要与 sales 表关联。
- **supplier_info** 主要与 stock_in、return_stock 表关联。
- **warehouse** 通过 inventory、inventory_check 关联药品。
- **role、permission、role_permission、user_role** 共同实现权限控制，user_role 关联员工与角色，role_permission 关联角色与权限。
- **sales_return** 通过 sales_id 关联 sales。
- **finance_stat** 汇总销售、成本、利润等数据。

下文详细列出各表字段。

## 1. 基础信息管理、系统维护（A负责）
- drug_info（药品信息表）
- employee_info（员工信息表）
- customer_info（客户信息表）
- supplier_info（供应商信息表）
- permission（权限表）
- role（角色表）
- role_permission（角色权限关联表）
- user_role（用户角色关联表）
- system_log（系统日志表）

## 2. 进货管理、库房管理（B负责）
- stock_in（入库登记表）
- inventory（库存表）
- warehouse（仓库表）
- inventory_check（库存盘点表）
- return_stock（退货处理表）

## 3. 销售管理、财务统计（C负责）
- sales（销售登记表）
- sales_return（销售退货表）
- finance_stat（财务统计表）

---

## 主要表结构设计（字段示例）

### drug_info（药品信息表）
- drug_id (PK)
- name
- spec
- manufacturer
- approval_number
- category (处方/非处方)
- unit
- purchase_price
- sale_price
- expiry_date
- status (在售/下架)
- create_time
- update_time

### employee_info（员工信息表）
- employee_id (PK)
- name
- department
- position
- phone
- hire_date
- account
- password (加密)
- status
- create_time
- update_time

### customer_info（客户信息表）
- customer_id (PK)
- name
- type (零售/批发)
- contact
- phone
- address
- create_time
- update_time

### supplier_info（供应商信息表）
- supplier_id (PK)
- name
- contact
- phone
- address
- qualification_no
- create_time
- update_time

### permission（权限表）
- permission_id (PK)
- name
- description

### role（角色表）
- role_id (PK)
- name
- description

### role_permission（角色权限关联表）
- id (PK)
- role_id (FK)
- permission_id (FK)

### user_role（用户角色关联表）
- id (PK)
- employee_id (FK)
- role_id (FK)

### system_log（系统日志表）
- log_id (PK)
- employee_id (FK)
- action_type (新增/修改/删除/登录/导出等)
- table_name
- action_time
- action_content

### stock_in（入库登记表）
- stock_in_id (PK)
- drug_id (FK)
- supplier_id (FK)
- quantity
- unit_price
- total_price
- stock_in_date
- employee_id (FK)
- remark
- create_time

### inventory（库存表）
- inventory_id (PK)
- drug_id (FK)
- warehouse_id (FK)
- quantity
- location
- last_check_date
- create_time
- update_time

### warehouse（仓库表）
- warehouse_id (PK)
- name
- address
- manager_id (FK)
- create_time

### inventory_check（库存盘点表）
- check_id (PK)
- drug_id (FK)
- warehouse_id (FK)
- checked_quantity
- actual_quantity
- diff_reason
- check_date
- employee_id (FK)
- create_time

### return_stock（退货处理表）
- return_id (PK)
- drug_id (FK)
- supplier_id (FK)
- quantity
- reason
- return_date
- employee_id (FK)
- create_time

### sales（销售登记表）
- sales_id (PK)
- drug_id (FK)
- customer_id (FK)
- quantity
- unit_price
- total_price
- sales_date
- employee_id (FK)
- create_time

### sales_return（销售退货表）
- sales_return_id (PK)
- sales_id (FK)
- quantity
- reason
- return_date
- employee_id (FK)
- create_time

### finance_stat（财务统计表）
- stat_id (PK)
- stat_type (日/月)
- stat_date
- total_sales
- total_cost
- total_profit
- employee_id (FK)
- create_time
